<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>ExapisSOP &#35373;&#35336;&#24605;&#24819; &gt; &#27010;&#24565; </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="ExapisSOP &#35373;&#35336;&#24605;&#24819; &gt; &#27010;&#24565; ">
    <meta name="generator" content="docfx 2.56.4.0">
    
    <link rel="shortcut icon" href="../favicon.ico">
    <link rel="stylesheet" href="../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../styles/docfx.css">
    <link rel="stylesheet" href="../styles/main.css">
    <meta property="docfx:navrel" content="../toc">
    <meta property="docfx:tocrel" content="toc">
    
    
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../index.html">
                <img id="logo" class="svg" src="../logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
                
                <ul class="nav level1 navbar-nav">
                      <li>
                          <a href="../api/index.html" title="API&#12502;&#12521;&#12454;&#12470;">API&#12502;&#12521;&#12454;&#12470;</a>
                      </li>
                      <li>
                          <a href="../architecture/concepts.html" title="&#35373;&#35336;&#24605;&#24819;">&#35373;&#35336;&#24605;&#24819;</a>
                      </li>
                </ul>    </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div role="main" class="container body-content hide-when-search">
        <div class="sidenav hide-when-search">
        	<a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle"></a>
        	<div class="sidetoggle collapse" id="sidetoggle">
        		<div>
        			<div class="sidefilter">
        				<form class="toc-filter">
        					<span class="glyphicon glyphicon-filter filter-icon"></span>
        					<input type="text" id="toc_filter_input" placeholder="&#26908;&#32034;..." onkeypress="if(event.keyCode==13) {return false;}">
        				</form>
        			</div>
        			<div class="sidetoc">
        				<div class="toc" id="toc">
        						
        						<ul class="nav level1">
        						  <li class="active">
        						    <span class="expand-stub"></span>
        						    <a href="concepts.html" title="&#27010;&#24565;" class="active">&#27010;&#24565;</a>
        						      
        						      <ul class="nav level2">
        						        <li class="">
        						          <a href="concepts.html#hostrunner" title="&#23455;&#34892;&#29872;&#22659;&#12392;&#12469;&#12540;&#12499;&#12473;" class="">&#23455;&#34892;&#29872;&#22659;&#12392;&#12469;&#12540;&#12499;&#12473;</a>
        						        </li>
        						        <li class="">
        						          <a href="concepts.html#appworker" title="AppWorker &#12463;&#12521;&#12473;&#12395;&#12388;&#12356;&#12390;" class="">AppWorker &#12463;&#12521;&#12473;&#12395;&#12388;&#12356;&#12390;</a>
        						        </li>
        						        <li class="">
        						          <a href="concepts.html#context" title="&#25991;&#33032;&#24773;&#22577;" class="">&#25991;&#33032;&#24773;&#22577;</a>
        						        </li>
        						        <li class="">
        						          <a href="concepts.html#file_system" title="&#12501;&#12449;&#12452;&#12523;&#31649;&#29702;&#12469;&#12540;&#12499;&#12473;" class="">&#12501;&#12449;&#12452;&#12523;&#31649;&#29702;&#12469;&#12540;&#12499;&#12473;</a>
        						        </li>
        						        <li class="">
        						          <a href="concepts.html#settings_system" title="&#35373;&#23450;&#24773;&#22577;&#31649;&#29702;&#12469;&#12540;&#12499;&#12473;" class="">&#35373;&#23450;&#24773;&#22577;&#31649;&#29702;&#12469;&#12540;&#12499;&#12473;</a>
        						        </li>
        						        <li class="">
        						          <a href="concepts.html#command_line" title="&#12467;&#12510;&#12531;&#12489;&#34892;&#24341;&#25968;&#35299;&#26512;&#12469;&#12540;&#12499;&#12473;" class="">&#12467;&#12510;&#12531;&#12489;&#34892;&#24341;&#25968;&#35299;&#26512;&#12469;&#12540;&#12499;&#12473;</a>
        						        </li>
        						        <li class="">
        						          <a href="concepts.html#logging_system" title="&#12525;&#12464;&#20986;&#21147;&#31649;&#29702;&#12469;&#12540;&#12499;&#12473;" class="">&#12525;&#12464;&#20986;&#21147;&#31649;&#29702;&#12469;&#12540;&#12499;&#12473;</a>
        						        </li>
        						      </ul>  </li>
        						</ul>				</div>
        			</div>
        		</div>
        	</div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="exapissop-設計思想--概念">ExapisSOP 設計思想 &gt; 概念</h1>

<p>Copyright (C) 2020 Takym.</p>
<p><a id="hostrunner"></a></p>
<h2 id="実行環境とサービス">実行環境とサービス</h2>
<p>実行環境とは<a class="xref" href="../api/ExapisSOP.HostRunner.html">HostRunner</a>クラスとその派生クラスのインスタンスの事で、
アプリケーション全体と登録されたサービスを管理し実行します。
一つのアプリケーション内に一つのみ実行環境を作成する事ができます。
サービスとは<a class="xref" href="../api/ExapisSOP.IService.html">IService</a>インターフェースを実装したクラスの事です。
サービスは様々な種類があり、プログラムに機能を提供します。
<img src="images/service_and_config_model.png" alt="The Services and Configuration Model">
上記の図の様にサービスを構成設定(<a class="xref" href="../api/ExapisSOP.IConfiguration.html">IConfiguration</a>)に登録する事で実行環境内で実行する事ができます。
下記のコードは実行環境を生成し構成設定を書き換えます。</p>
<pre><code class="lang-csharp">// string[] args にコマンド行引数が格納されていると仮定します。
var host = HostRunner.Create(args); // 実行環境を生成します。
host.Configure((config) =&gt; { // 構成設定を書き換える関数を実行環境へ提供します。
	config.AddService(...); // サービスを追加します。
	// 以下の様に一行に繋げる事もできます。また、できるだけ一行に繋げる事を推奨します。
	config.AddService(/*サービスオブジェクト*/).AddService(/*サービスオブジェクト*/).AddService(/*サービスオブジェクト*/);
});
</code></pre>
<p>ExapisSOP ではコマンドライン引数は<strong>コマンド行引数</strong>と省略します。</p>
<p><a id="appworker"></a></p>
<h2 id="appworker-クラスについて">AppWorker クラスについて</h2>
<p>アプリケーションは<a class="xref" href="../api/ExapisSOP.AppWorker.html">AppWorker</a>の派生クラスを一つ以上作成しそこに処理を記述します。
<a class="xref" href="../api/ExapisSOP.AppWorker.html">AppWorker</a>もサービスです。以下のコードの様に記述します。</p>
<pre><code class="lang-csharp">class Program : AppWorker
{
	// サービス初期化時に呼び出されます。
	public override async Task InitializeAsync(IContext context)
	{
		// 開始処理を登録します。
		this.Startup += this.Program_Startup;
		// 更新処理を登録します。
		this.Update += this.Program_Update;
		// 終了処理を登録します。
		this.Shutdown += this.Program_Shutdown;
		// 既定クラスの InitializeAsync を呼び出します。
		await base.InitializeAsync(context);
	}

	// アプリケーション開始時に呼び出されます。
	void Program_Startup(object? sender, ContextEventArgs e)
	{
		// ここにアプリケーション開始時に行うべき動作を記述します。
	}
	
	// アプリケーション更新時に呼び出されます。
	void Program_Update(object? sender, ContextEventArgs e)
	{
		// ここにアプリケーション更新時に行うべき動作を記述します。

		// アプリケーションを終了するには TerminationException を発生させます。
		throw new TerminationException();

		// このイベントは TerminationException が呼び出されるまで延々と呼び出され続けます。
	}
	
	// アプリケーション終了時に呼び出されます。
	void Program_Shutdown(object? sender, ContextEventArgs e)
	{
		// ここにアプリケーション終了時に行うべき動作を記述します。
	}
}
</code></pre>
<p><a class="xref" href="../api/ExapisSOP.AppWorker.html">AppWorker</a>は<a class="xref" href="../api/ExapisSOP.Core.ConfigurationExtensions.AddAppWorker.html#ExapisSOP_Core_ConfigurationExtensions_AddAppWorker__1_ExapisSOP_IConfiguration_">AddAppWorker&lt;TAppWorker&gt;(IConfiguration)</a>を利用し実行環境へ登録します。
<code>TAppWorker</code>は<a class="xref" href="../api/ExapisSOP.AppWorker.html">AppWorker</a>から派生したクラスを表します。</p>
<pre><code class="lang-csharp">// string[] args にコマンド行引数が格納されていると仮定します。
var host = HostRunner.Create(args); // 実行環境を生成します。
host.Configure((config) =&gt; { // 構成設定を書き換える関数を実行環境へ提供します。
	config.AddAppWorker&lt;Program&gt;(); // Program を AppWorker として実行する様に登録します。
});
</code></pre>
<p><a id="context"></a></p>
<h2 id="文脈情報">文脈情報</h2>
<p>文脈情報とは<a class="xref" href="../api/ExapisSOP.IContext.html">IContext</a>インターフェースの事です。
実行環境により自動的に生成され、サービスへ提供されます。
実行に必要な様々な情報を保持しています。
サービス間での情報の受け渡しには文脈情報を利用します。</p>
<p><a id="file_system"></a></p>
<h2 id="ファイル管理サービス">ファイル管理サービス</h2>
<p><a class="xref" href="../api/ExapisSOP.IO.IFileSystemService.html">IFileSystemService</a>はファイルを管理する機能を提供します。
以下の様にして登録します：</p>
<pre><code class="lang-csharp">config.AddFileSystem();
</code></pre>
<p><a id="settings_system"></a></p>
<h2 id="設定情報管理サービス">設定情報管理サービス</h2>
<p><a class="xref" href="../api/ExapisSOP.IO.Settings.ISettingsSystemService.html">ISettingsSystemService</a>は設定情報を管理する機能を提供します。
このサービスを利用する場合はファイル管理サービスを登録しておく必要があります。
以下の様にして登録します：</p>
<pre><code class="lang-csharp">config.AddFileSystem().AddSettingsSystem();
</code></pre>
<p><a id="command_line"></a></p>
<h2 id="コマンド行引数解析サービス">コマンド行引数解析サービス</h2>
<p><a class="xref" href="../api/ExapisSOP.IO.Settings.CommandLine.ICommandLineService.html">ICommandLineService</a>はコマンド行引数を解析する機能を提供します。
このサービスを利用する場合は設定情報管理サービスを登録しておく必要があります。
以下の様にして登録します：</p>
<pre><code class="lang-csharp">config.AddFileSystem().AddSettingsSystem().AddCommandLine();
</code></pre>
<p><a id="logging_system"></a></p>
<h2 id="ログ出力管理サービス">ログ出力管理サービス</h2>
<p><a class="xref" href="../api/ExapisSOP.IO.Logging.ILoggingSystemService.html">ILoggingSystemService</a>はログ出力を管理する機能を提供します。
このサービスを利用する場合は設定情報管理サービスを登録しておく必要があります。
また、コマンド行引数解析サービスと併用する場合は、このサービスはコマンド行引数解析サービスより後に登録しなければなりません。
以下の様にして登録します：</p>
<pre><code class="lang-csharp">// コマンド行引数解析サービスを追加しない場合：
config.AddFileSystem().AddSettingsSystem().AddLoggingSystem();
// コマンド行引数解析サービスを追加する場合：
config.AddFileSystem().AddSettingsSystem().AddCommandLine().AddLoggingSystem();
// または以下の様に書けます：
config.AddSystemServices();
</code></pre>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/Takym/ExapisSOP/blob/master/docs.gen/architecture/concepts.md/#L1" class="contribution-link">&#32232;&#38598;/&#25552;&#26696;</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
                <h5>&#12371;&#12398;&#35352;&#20107;&#12398;&#24773;&#22577;</h5>
                <div></div>
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
      	<div class="grad-bottom"></div>
      	<div class="footer">
      		<div class="container">
      			<span class="pull-right">
      				<a href="#top">&#12506;&#12540;&#12472;&#12398;&#20808;&#38957;&#12408;</a>
      			</span>
      			
      				<span>Copyright (C) 2020 Takym.</span>
      				<br>
      				<span>Generated by <strong>DocFX</strong></span>
      		</div>
      	</div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../styles/docfx.js"></script>
    <script type="text/javascript" src="../styles/main.js"></script>
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-99298946-3"></script>
    <script>
    	window.dataLayer = window.dataLayer || [];
    	function gtag() { dataLayer.push(arguments); }
    	gtag('js', new Date());
    	gtag('config', 'UA-99298946-3');
    </script>
  </body>
</html>
